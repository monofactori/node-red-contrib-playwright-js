<script type="text/javascript">
    RED.nodes.registerType('playwright-session-end', {
        category: 'function',
        color: '#F44336',
        defaults: {
            name: {value: ""},
            close_all: {value: false}
        },
        inputs: 1,
        outputs: 2,
        outputLabels: ["–£—Å–ø–µ—Ö", "–û—à–∏–±–∫–∞"],
        icon: "font-awesome/fa-stop-circle",
        label: function() {
            if (this.name) return this.name;
            return this.close_all ? "–ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ—Å—Å–∏–∏" : "–ó–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é";
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        }
    });
</script>

<script type="text/html" data-template-name="playwright-session-end">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> –ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input type="text" id="node-input-name" placeholder="–ó–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é">
    </div>
    
    <div class="form-row">
        <label for="node-input-close_all" style="width:auto">
            <input type="checkbox" id="node-input-close_all" style="display:inline-block; width:auto; vertical-align:baseline;">
            &nbsp;<i class="fa fa-times-circle"></i> –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ—Å—Å–∏–∏
        </label>
    </div>
    
    <div class="form-tips">
        <p><strong>üî¥ –≠—Ç–∞ –Ω–æ–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã.</strong></p>
        <p><strong>üìç –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:</strong></p>
        <ul>
            <li><strong>–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º:</strong> session_id –±–µ—Ä–µ—Ç—Å—è –∏–∑ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–¥–Ω–∞ —Å–µ—Å—Å–∏—è</li>
            <li><strong>–ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ:</strong> –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç session_id, –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞</li>
        </ul>
        <p>‚ö†Ô∏è –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.</p>
    </div>
</script>

<script type="text/html" data-help-name="playwright-session-end">
    <p>üî¥ <strong>–ó–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é –±—Ä–∞—É–∑–µ—Ä–∞</strong></p>
    
    <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
    <p>–ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é –±—Ä–∞—É–∑–µ—Ä–∞ (–∏–ª–∏ –≤—Å–µ —Å–µ—Å—Å–∏–∏) –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã.</p>
    
    <h3>–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã</h3>
    <ul>
        <li><strong>–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º:</strong> –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –æ–¥–Ω—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å–µ—Å—Å–∏—é –ø–æ session_id</li>
        <li><strong>–ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ—Å—Å–∏–∏:</strong> –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Ä–∞–∑–æ–º</li>
    </ul>
    
    <h3>–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
    <dl class="message-properties">
        <dt>session_id <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd><strong>–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞.</strong> ID —Å–µ—Å—Å–∏–∏ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è</dd>
        
        <dt>msg.close_all <span class="property-type">boolean</span></dt>
        <dd><strong>–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ.</strong> –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –Ω–æ–¥—ã –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π</dd>
    </dl>

    <h3>–í—ã—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
    <dl class="message-properties">
        <dt>payload.success <span class="property-type">boolean</span></dt>
        <dd>–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏/—Å–µ—Å—Å–∏–π</dd>
        
        <dt>payload.closed <span class="property-type">boolean|number</span></dt>
        <dd>–î–ª—è –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏: true/false. –î–ª—è –≤—Å–µ—Ö: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–µ—Å—Å–∏–π</dd>
        
        <dt>payload.sessions_info <span class="property-type">array</span></dt>
        <dd>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–µ—Å—Å–∏—è—Ö (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ "–∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ")</dd>
        
        <dt>payload.message <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd>–°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</dd>
    </dl>

    <h3>–í—ã—Ö–æ–¥—ã</h3>
    <ol class="node-ports">
        <li><strong>–£—Å–ø–µ—Ö:</strong> –°–µ—Å—Å–∏—è(–∏) –∑–∞–∫—Ä—ã—Ç—ã —É—Å–ø–µ—à–Ω–æ</li>
        <li><strong>–û—à–∏–±–∫–∞:</strong> –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏</li>
    </ol>

    <h3>–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h3>
    
    <h4>–ó–∞–∫—Ä—ã—Ç–∏–µ –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏:</h4>
    <pre>
// –í—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
{
  "session_id": "sess_1672531200000_abc123"
}

// –í—ã—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
{
  "payload": {
    "success": true,
    "closed": true,
    "session_id": "sess_1672531200000_abc123",
    "message": "–°–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞ —É—Å–ø–µ—à–Ω–æ"
  }
}
    </pre>
    
    <h4>–ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π:</h4>
    <pre>
// –í—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (session_id –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è):
{
  "any": "data"
}

// –í—ã—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
{
  "payload": {
    "success": true,
    "closed": 3,
    "mode": "close_all",
    "sessions_info": [...],
    "message": "–ó–∞–∫—Ä—ã—Ç–æ 3 —Å–µ—Å—Å–∏–∏"
  }
}
    </pre>
    
    <h3>–í–∞–∂–Ω–æ</h3>
    <ul>
        <li>üßπ <strong>–û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã:</strong> –±—Ä–∞—É–∑–µ—Ä—ã, –ø–∞–º—è—Ç—å, –ø—Ä–æ—Ü–µ—Å—Å—ã</li>
        <li>‚ö†Ô∏è <strong>–ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è</strong> session_id —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏</li>
        <li>üîÑ <strong>–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞:</strong> —Å–µ—Å—Å–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 –º–∏–Ω –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</li>
        <li>üõë <strong>Graceful shutdown:</strong> –≤—Å–µ —Å–µ—Å—Å–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ Node-RED</li>
        <li>‚ö° <strong>"–ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ"</strong> –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ—Å–ª–µ –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–ª–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö</li>
    </ul>
    
    <h3>–¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏</h3>
    
    <h4>–û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</h4>
    <pre>
[inject] ‚Üí [session-start] ‚Üí [session-action] ‚Üí [session-end]
   ‚Üì            ‚Üì                  ‚Üì               ‚Üì
 –°—Ç–∞—Ä—Ç      –û—Ç–∫—Ä—ã—Ç—å           –í—ã–ø–æ–ª–Ω–∏—Ç—å        –ó–∞–∫—Ä—ã—Ç—å
           –±—Ä–∞—É–∑–µ—Ä           –¥–µ–π—Å—Ç–≤–∏—è         –±—Ä–∞—É–∑–µ—Ä
    </pre>
    
    <h4>–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:</h4>
    <pre>
[inject] ‚Üí [session-end —Å "–ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ"]
   ‚Üì              ‚Üì
–¢—Ä–∏–≥–≥–µ—Ä    –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –±—Ä–∞—É–∑–µ—Ä—ã
          (–æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤)
    </pre>
</script> 