<script type="text/javascript">
    RED.nodes.registerType('playwright-session-action', {
        category: 'function',
        color: '#2196F3',
        defaults: {
            name: {value: ""},
            action: {value: "", required: false},
            selector: {value: "", required: false},
            value: {value: "", required: false},
            url: {value: "", required: false},
            timeout: {value: 30000, required: false, validate: function(v) { return v === "" || !isNaN(v); }},
            wait_after: {value: 0, required: false, validate: function(v) { return v === "" || !isNaN(v); }}
        },
        inputs: 1,
        outputs: 2,
        outputLabels: ["–£—Å–ø–µ—Ö", "–û—à–∏–±–∫–∞"],
        icon: "font-awesome/fa-cogs",
        label: function() {
            if (this.name) return this.name;
            if (this.action) return "–î–µ–π—Å—Ç–≤–∏–µ: " + this.action;
            return "–î–µ–π—Å—Ç–≤–∏–µ –≤ —Å–µ—Å—Å–∏–∏";
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏—è
            $("#node-input-action").change(function() {
                const action = $(this).val();
                showHideFields(action);
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–µ–π—Å—Ç–≤–∏—è
            function showHideFields(action) {
                $(".action-field").hide();
                
                // –î–µ–π—Å—Ç–≤–∏—è —Ç—Ä–µ–±—É—é—â–∏–µ CSS —Å–µ–ª–µ–∫—Ç–æ—Ä
                const selectorActions = [
                    'fill_form', 'fill_multiple', 'click', 'hover', 'focus', 
                    'get_text', 'wait_for_element', 'wait_for_text', 'select_option', 
                    'type_text', 'upload_file'
                ];
                if (selectorActions.includes(action)) {
                    $(".field-selector").show();
                }
                
                // –î–µ–π—Å—Ç–≤–∏—è —Ç—Ä–µ–±—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                const valueActions = [
                    'fill_form', 'type_text', 'select_option', 'press_key',
                    'stealth_user_agent', 'stealth_viewport', 'stealth_geolocation', 
                    'stealth_timezone', 'execute_js'
                ];
                if (valueActions.includes(action)) {
                    $(".field-value").show();
                }
                
                // –î–µ–π—Å—Ç–≤–∏—è —Ç—Ä–µ–±—É—é—â–∏–µ URL
                if (action === 'navigate') {
                    $(".field-url").show();
                    $(".field-waituntil").show();
                }
                
                // –î–µ–π—Å—Ç–≤–∏—è —Å —Ç–∞–π–º–∞—É—Ç–æ–º
                const timeoutActions = [
                    'wait_for_element', 'wait_for_text', 'wait_for_load', 
                    'wait_for_navigation', 'wait_timeout', 'click'
                ];
                if (timeoutActions.includes(action)) {
                    $(".field-timeout").show();
                }
                
                // –î–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –ø–æ—Å–ª–µ
                if (action === 'click' || action === 'type_text') {
                    $(".field-wait-after").show();
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            setTimeout(() => {
                showHideFields($("#node-input-action").val());
            }, 100);
        }
    });
</script>

<script type="text/html" data-template-name="playwright-session-action">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> –ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input type="text" id="node-input-name" placeholder="–î–µ–π—Å—Ç–≤–∏–µ –≤ —Å–µ—Å—Å–∏–∏">
    </div>
    
    <div class="form-row">
        <label for="node-input-action"><i class="fa fa-play"></i> –î–µ–π—Å—Ç–≤–∏–µ</label>
        <select id="node-input-action">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ --</option>
            <optgroup label="üìù –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö">
                <option value="fill_form">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ</option>
                <option value="fill_multiple">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π</option>
                <option value="type_text">–ü–µ—á–∞—Ç–∞—Ç—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π</option>
                <option value="select_option">–í—ã–±—Ä–∞—Ç—å –≤ dropdown</option>
                <option value="press_key">–ù–∞–∂–∞—Ç—å –∫–ª–∞–≤–∏—à—É</option>
            </optgroup>
            <optgroup label="üñ±Ô∏è –ö–ª–∏–∫–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
                <option value="click">–ö–ª–∏–∫–Ω—É—Ç—å</option>
                <option value="hover">–ù–∞–≤–µ—Å—Ç–∏ –º—ã—à—å</option>
                <option value="focus">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–æ–∫—É—Å</option>
                <option value="scroll">–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</option>
                <option value="navigate">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É</option>
                <option value="go_back">–ù–∞–∑–∞–¥</option>
                <option value="go_forward">–í–ø–µ—Ä–µ–¥</option>
                <option value="reload">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</option>
            </optgroup>
            <optgroup label="üç™ Cookies –∏ Storage">
                <option value="set_cookies">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cookies</option>
                <option value="get_cookies">–ü–æ–ª—É—á–∏—Ç—å cookies</option>
                <option value="clear_cookies">–û—á–∏—Å—Ç–∏—Ç—å cookies</option>
                <option value="set_local_storage">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å localStorage</option>
            </optgroup>
            <optgroup label="üìÇ –§–∞–π–ª—ã">
                <option value="upload_file">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</option>
                <option value="download_file">–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</option>
            </optgroup>
            <optgroup label="üåê Headers –∏ —ç–º—É–ª—è—Ü–∏—è">
                <option value="set_user_agent">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å User-Agent</option>
                <option value="set_extra_headers">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏</option>
                <option value="emulate_device">–≠–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</option>
                <option value="set_viewport">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞</option>
            </optgroup>
            <optgroup label="üõ°Ô∏è –û–±—Ö–æ–¥ –∑–∞—â–∏—Ç">
                <option value="accept_cookie_banner">–ü—Ä–∏–Ω—è—Ç—å cookie banner</option>
                <option value="handle_dialog">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∏–∞–ª–æ–≥</option>
            </optgroup>
            <optgroup label="‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ">
                <option value="wait_for_element">–ñ–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç</option>
                <option value="wait_for_text">–ñ–¥–∞—Ç—å —Ç–µ–∫—Å—Ç</option>
                <option value="wait_for_load">–ñ–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏</option>
                <option value="wait_for_navigation">–ñ–¥–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</option>
                <option value="wait_timeout">–ü—Ä–æ—Å—Ç–æ –∂–¥–∞—Ç—å</option>
            </optgroup>
            <optgroup label="üíª JavaScript">
                <option value="execute_js">–í—ã–ø–æ–ª–Ω–∏—Ç—å JavaScript</option>
            </optgroup>
            <optgroup label="üõ°Ô∏è –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω—Ç–∏–¥–µ—Ç–µ–∫—Ç">
                <option value="stealth_mode">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Å—Ç–µ–ª—Å-—Ä–µ–∂–∏–º</option>
                <option value="test_bot_detection">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é –±–æ—Ç–∞</option>
                <option value="stealth_user_agent">–°–º–µ–Ω–∏—Ç—å User-Agent</option>
                <option value="stealth_viewport">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞</option>
                <option value="stealth_geolocation">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é</option>
                <option value="stealth_timezone">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–æ–Ω—É</option>
            </optgroup>
            <optgroup label="üìä –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö">
                <option value="screenshot">–°–∫—Ä–∏–Ω—à–æ—Ç</option>
                <option value="scrape">–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ</option>
                <option value="get_text">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç</option>
                <option value="get_page_info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</option>
                <option value="get_all_links">–í—Å–µ —Å—Å—ã–ª–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</option>
            </optgroup>
        </select>
    </div>
    
    <div class="form-row field-selector action-field" style="display:none;">
        <label for="node-input-selector"><i class="fa fa-crosshairs"></i> CSS —Å–µ–ª–µ–∫—Ç–æ—Ä</label>
        <input type="text" id="node-input-selector" placeholder="input[name='email'], button.submit">
        <div class="form-tips">CSS —Å–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ (–¥–ª—è fill_form, click, etc.)</div>
    </div>
    
    <div class="form-row field-url action-field" style="display:none;">
        <label for="node-input-url"><i class="fa fa-link"></i> URL</label>
        <input type="text" id="node-input-url" placeholder="https://example.com">
        <div class="form-tips">URL –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ (–¥–ª—è navigate)</div>
    </div>
    
    <div class="form-row field-waituntil action-field" style="display:none;">
        <label for="node-input-waituntil"><i class="fa fa-hourglass-half"></i> –û–∂–∏–¥–∞—Ç—å</label>
        <select id="node-input-waituntil">
            <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (domcontentloaded)</option>
            <option value="domcontentloaded">DOM –∑–∞–≥—Ä—É–∂–µ–Ω (–±—ã—Å—Ç—Ä–æ)</option>
            <option value="load">–ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–º–µ–¥–ª–µ–Ω–Ω–æ)</option>
            <option value="networkidle">–ù–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å)</option>
        </select>
        <div class="form-tips">–¢–∏–ø –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è navigate - –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å</div>
    </div>
    
    <div class="form-row field-value action-field" style="display:none;">
        <label for="node-input-value"><i class="fa fa-pencil"></i> –ó–Ω–∞—á–µ–Ω–∏–µ</label>
        <input type="text" id="node-input-value" placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –≤–≤–æ–¥–∞">
        <div class="form-tips">–ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–≤–æ–¥–∞ –≤ –ø–æ–ª–µ (–¥–ª—è fill_form)</div>
    </div>
    
    <div class="form-row field-timeout action-field" style="display:none;">
        <label for="node-input-timeout"><i class="fa fa-clock-o"></i> –¢–∞–π–º–∞—É—Ç (–º—Å)</label>
        <input type="number" id="node-input-timeout" placeholder="30000">
        <div class="form-tips">–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö</div>
    </div>
    
    <div class="form-row field-wait-after action-field" style="display:none;">
        <label for="node-input-wait_after"><i class="fa fa-pause"></i> –ñ–¥–∞—Ç—å –ø–æ—Å–ª–µ (–º—Å)</label>
        <input type="number" id="node-input-wait_after" placeholder="0">
        <div class="form-tips">–ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è</div>
    </div>
</script>

<script type="text/html" data-help-name="playwright-session-action">
    <p>üîµ <strong>–î–µ–π—Å—Ç–≤–∏–µ –≤ —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞</strong></p>
    
    <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
    <p>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –Ω–æ–¥–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞.</p>
    
    <h3>–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
    <dl class="message-properties">
        <dt>session_id <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd><strong>–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.</strong> ID —Å–µ—Å—Å–∏–∏ –æ—Ç playwright-session-start</dd>
        
        <dt>action <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd>–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è: fill_form, click, screenshot, etc.</dd>
        
        <dt>selector <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd>CSS —Å–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞</dd>
        
        <dt>value <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd>–ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–≤–æ–¥–∞</dd>
    </dl>

    <h3>üõ°Ô∏è –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω—Ç–∏–¥–µ—Ç–µ–∫—Ç (NEW!)</h3>
    <ul>
        <li><strong>stealth_mode</strong> - –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Å–æ–∫—Ä—ã—Ç–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (–æ–±—Ö–æ–¥ bot.sannysoft.com)</li>
        <li><strong>test_bot_detection</strong> - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ –Ω–∞ bot.sannysoft.com</li>
        <li><strong>stealth_user_agent</strong> - —Ä–æ—Ç–∞—Ü–∏—è User-Agent</li>
        <li><strong>stealth_viewport</strong> - —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —ç–∫—Ä–∞–Ω–∞</li>
        <li><strong>stealth_geolocation</strong> - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏</li>
        <li><strong>stealth_timezone</strong> - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω–æ–π</li>
    </ul>

    <h3>üìù –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
    <ul>
        <li><strong>fill_form</strong> - –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ (selector, value)</li>
        <li><strong>fill_multiple</strong> - –∑–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π (fields)</li>
        <li><strong>click</strong> - –∫–ª–∏–∫–Ω—É—Ç—å —ç–ª–µ–º–µ–Ω—Ç (selector)</li>
        <li><strong>navigate</strong> - –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (url)</li>
        <li><strong>screenshot</strong> - —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç</li>
        <li><strong>wait_for_element</strong> - –∂–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç (selector)</li>
        <li><strong>execute_js</strong> - –≤—ã–ø–æ–ª–Ω–∏—Ç—å JavaScript (code)</li>
        <li><strong>get_page_info</strong> - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</li>
    </ul>

    <h3>üõ°Ô∏è –ü—Ä–∏–º–µ—Ä —Å—Ç–µ–ª—Å-—Å–µ—Ä—Ñ–∏–Ω–≥–∞</h3>
    <pre>
// 1. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –∞–Ω—Ç–∏–¥–µ—Ç–µ–∫—Ç–∞
{
  "session_id": "sess_12345",
  "action": "stealth_mode"
}

// 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–µ–∫—Ü–∏–∏
{
  "session_id": "sess_12345", 
  "action": "test_bot_detection"
}

// 3. –û–±—ã—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
{
  "session_id": "sess_12345",
  "action": "fill_form",
  "selector": "input[name='email']",
  "value": "user@example.com"
}
    </pre>
</script> 