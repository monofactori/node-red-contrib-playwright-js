<script type="text/javascript">
    RED.nodes.registerType('playwright-session-action', {
        category: 'function',
        color: '#2196F3',
        defaults: {
            name: {value: ""},
            action: {value: "", required: false},
            selector: {value: "", required: false},
            value: {value: "", required: false},
            url: {value: "", required: false},
            timeout: {value: 30000, required: false, validate: function(v) { return v === "" || !isNaN(v); }},
            wait_after: {value: 0, required: false, validate: function(v) { return v === "" || !isNaN(v); }}
        },
        inputs: 1,
        outputs: 2,
        outputLabels: ["–£—Å–ø–µ—Ö", "–û—à–∏–±–∫–∞"],
        icon: "font-awesome/fa-cogs",
        label: function() {
            if (this.name) return this.name;
            if (this.action) return "–î–µ–π—Å—Ç–≤–∏–µ: " + this.action;
            return "–î–µ–π—Å—Ç–≤–∏–µ –≤ —Å–µ—Å—Å–∏–∏";
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏—è
            $("#node-input-action").change(function() {
                const action = $(this).val();
                showHideFields(action);
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–µ–π—Å—Ç–≤–∏—è
            function showHideFields(action) {
                $(".action-field").hide();
                
                if (action.includes('fill') || action === 'click' || action === 'get_text' || action === 'wait_for_element') {
                    $(".field-selector").show();
                }
                
                if (action.includes('fill')) {
                    $(".field-value").show();
                }
                
                if (action === 'navigate') {
                    $(".field-url").show();
                }
                
                if (action.includes('wait') || action === 'click') {
                    $(".field-timeout").show();
                }
                
                if (action === 'click') {
                    $(".field-wait-after").show();
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            setTimeout(() => {
                showHideFields($("#node-input-action").val());
            }, 100);
        }
    });
</script>

<script type="text/html" data-template-name="playwright-session-action">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> –ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input type="text" id="node-input-name" placeholder="–î–µ–π—Å—Ç–≤–∏–µ –≤ —Å–µ—Å—Å–∏–∏">
    </div>
    
    <div class="form-row">
        <label for="node-input-action"><i class="fa fa-play"></i> –î–µ–π—Å—Ç–≤–∏–µ</label>
        <select id="node-input-action">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ --</option>
            <optgroup label="üìù –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö">
                <option value="fill_form">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ</option>
                <option value="select_option">–í—ã–±—Ä–∞—Ç—å –≤ dropdown</option>
            </optgroup>
            <optgroup label="üñ±Ô∏è –ö–ª–∏–∫–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
                <option value="click">–ö–ª–∏–∫–Ω—É—Ç—å</option>
                <option value="navigate">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É</option>
                <option value="go_back">–ù–∞–∑–∞–¥</option>
                <option value="reload">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</option>
            </optgroup>
            <optgroup label="‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ">
                <option value="wait_for_element">–ñ–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç</option>
                <option value="wait_timeout">–ü—Ä–æ—Å—Ç–æ –∂–¥–∞—Ç—å</option>
            </optgroup>
            <optgroup label="üìä –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö">
                <option value="screenshot">–°–∫—Ä–∏–Ω—à–æ—Ç</option>
                <option value="scrape">–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ</option>
                <option value="get_text">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç</option>
            </optgroup>
        </select>
    </div>
    
    <div class="form-row">
        <label for="node-input-selector"><i class="fa fa-crosshairs"></i> CSS —Å–µ–ª–µ–∫—Ç–æ—Ä</label>
        <input type="text" id="node-input-selector" placeholder="input[name='email'], button.submit">
        <div class="form-tips">CSS —Å–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ (–¥–ª—è fill_form, click, etc.)</div>
    </div>
    
    <div class="form-row">
        <label for="node-input-value"><i class="fa fa-pencil"></i> –ó–Ω–∞—á–µ–Ω–∏–µ</label>
        <input type="text" id="node-input-value" placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –≤–≤–æ–¥–∞">
        <div class="form-tips">–ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–≤–æ–¥–∞ –≤ –ø–æ–ª–µ (–¥–ª—è fill_form)</div>
    </div>
</script>

<script type="text/html" data-help-name="playwright-session-action">
    <p>üîµ <strong>–î–µ–π—Å—Ç–≤–∏–µ –≤ —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞</strong></p>
    
    <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
    <p>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –Ω–æ–¥–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞.</p>
    
    <h3>–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
    <dl class="message-properties">
        <dt>session_id <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd><strong>–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.</strong> ID —Å–µ—Å—Å–∏–∏ –æ—Ç playwright-session-start</dd>
        
        <dt>action <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd>–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è: fill_form, click, screenshot, etc.</dd>
        
        <dt>selector <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd>CSS —Å–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞</dd>
        
        <dt>value <span class="property-type">—Å—Ç—Ä–æ–∫–∞</span></dt>
        <dd>–ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –≤–≤–æ–¥–∞</dd>
    </dl>

    <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
    <ul>
        <li><strong>fill_form</strong> - –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ (selector, value)</li>
        <li><strong>click</strong> - –∫–ª–∏–∫–Ω—É—Ç—å —ç–ª–µ–º–µ–Ω—Ç (selector)</li>
        <li><strong>screenshot</strong> - —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç</li>
        <li><strong>navigate</strong> - –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (url)</li>
        <li><strong>wait_for_element</strong> - –∂–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç (selector)</li>
        <li><strong>scrape</strong> - –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ (selectors)</li>
    </ul>

    <h3>–ü—Ä–∏–º–µ—Ä</h3>
    <pre>
{
  "session_id": "sess_12345",
  "action": "fill_form",
  "selector": "input[name='email']",
  "value": "user@example.com"
}
    </pre>
</script> 